<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>RunNow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css"><!-- ì¶”ê°€: ë¶„ë¦¬ëœ CSS íŒŒì¼ -->
</head>
<body>
    <div class="container">
        <h3 class="mb-4">2025 ë§ˆë¼í†¤ ì¼ì • ğŸƒâ€â™‚ï¸</h3>
        <div class="mb-4 filter">
          <!-- ì§€ì—­ í•„í„° ë²„íŠ¼ UI: btn-groupìœ¼ë¡œ ë³€ê²½ -->
          <div class="mb-2">
              <div class="btn-group" role="group" aria-label="ì§€ì—­ í•„í„°">
                  <button class="btn btn-outline-dark filter-btn active" data-filter="all">ì „ì²´ ì§€ì—­</button>
                  <button class="btn btn-outline-dark filter-btn" data-filter="metro">ìˆ˜ë„ê¶Œ</button>
                  <button class="btn btn-outline-dark filter-btn" data-filter="nonmetro">ë¹„ìˆ˜ë„ê¶Œ</button>
              </div>
          </div>
          <!-- ì½”ìŠ¤ í•„í„° ë²„íŠ¼ UI: btn-groupìœ¼ë¡œ ë³€ê²½ -->
          <div class="mb-2">
              <div class="btn-group" role="group" aria-label="ì½”ìŠ¤ í•„í„°">
                  <button class="btn btn-outline-dark course-filter-btn active" data-course="all">ì „ì²´ ì½”ìŠ¤</button>
                  <button class="btn btn-outline-dark course-filter-btn" data-course="Full">Full</button>
                  <button class="btn btn-outline-dark course-filter-btn" data-course="Half">Half</button>
                  <button class="btn btn-outline-dark course-filter-btn" data-course="10km">10km</button>
                  <button class="btn btn-outline-dark course-filter-btn" data-course="5km">5kì´í•˜</button>
              </div>
          </div>
          <!-- ì§€ë‚œëŒ€íšŒ ë³´ê¸° ìŠ¤ìœ„ì¹˜ ì¶”ê°€ -->
          <div class="form-check form-switch d-flex align-items-center ms-1 mt-2">
              <input class="form-check-input" type="checkbox" id="showPastSwitch">
              <label class="form-check-label ms-2 small" for="showPastSwitch">ì§€ë‚œëŒ€íšŒ ë³´ê¸°</label>
          </div>
        </div>
        <div id="marathon-list"></div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>


<script type="text/javascript">
const csvUrl = 'https://docs.google.com/spreadsheets/d/1z67BXtYTMB0PySBjvTMz_IOiOy3JCKCx/export?format=csv';

// ìˆ˜ë„ê¶Œ ì§€ì—­ëª… ë¦¬ìŠ¤íŠ¸
const metroRegions = ['ì„œìš¸', 'ê²½ê¸°', 'ì¸ì²œ'];

let allCards = [];

Papa.parse(csvUrl, {
  download: true,
  header: true,
  complete: function(results) {
    const data = results.data;
    $('#marathon-list').empty();
    allCards = [];
    data.forEach((row, idx) => {
        const region = (row.Location || '').split(',')[0].trim();
        const isMetro = metroRegions.includes(region);

        // ë‚ ì§œ ë¹„êµìš©: Date1ì´ MM.DD ë˜ëŠ” YYYY.MM.DD í˜•ì‹ì´ë¼ê³  ê°€ì •
        let eventDate = null;
        if (row.Date1) {
            let today = new Date();
            let year = today.getFullYear();
            let dateStr = row.Date1.trim().replace(/\s/g, ''); // ê³µë°± ì œê±°
            if (/^\d{1,2}\.\d{1,2}$/.test(dateStr)) {
                // MM.DD í˜•ì‹
                eventDate = new Date(year, Number(dateStr.split('.')[0]) - 1, Number(dateStr.split('.')[1]));
            } else if (/^\d{4}\.\d{1,2}\.\d{1,2}$/.test(dateStr)) {
                // YYYY.MM.DD í˜•ì‹
                let parts = dateStr.split('.');
                eventDate = new Date(Number(parts[0]), Number(parts[1]) - 1, Number(parts[2]));
            }
        }

        // ì¹´ë“œ HTML ìƒì„±
        const cardHtml = `
            <div class="card border-light mb-3 shadow-sm rounded-4 bg-white marathon-card"
                 data-region="${isMetro ? 'metro' : 'nonmetro'}"
                 data-course="${(row.Course || '').replace(/\s/g,'')}"
                 data-eventdate="${eventDate ? eventDate.toISOString().slice(0,10) : ''}">
            <div class="card-body p-3 d-flex flex-row align-items-center">
                <div class="bg-light rounded-3 d-flex flex-column justify-content-center align-items-center me-3 date-box">
                <div class="fw-light fs-4">${row.Date1}</div>
                <div class="text-muted small">${row.Date2}</div>
                </div>
                <div class="flex-grow-1">
                <div class="d-flex justify-content-between align-items-start mb-1">
                    <div>
                    <h5 class="mb-1 fw-bold">${row.Name}</h5>
                    <div class="text-muted small">${row.Location}</div>
                    </div>
                    <div class="status">
                    <span class="badge text-bg-dark">${row.Status}</span>
                    </div>
                </div>
                <div class="course-tags" data-course="${row.Course}"></div>
                </div>
            </div>
            </div>
        `;
        allCards.push(cardHtml);
        $('#marathon-list').append(cardHtml);
    });

    // íƒœê·¸ ì²˜ë¦¬
    $('.course-tags').each(function () {
        const courseStr = $(this).data('course');
        if (!courseStr) return;
        const courses = courseStr.split(',').map(c => c.trim());
        const tags = courses.map(course => {
          let tagClass = 'text-bg-light';
          if (/half/i.test(course)) tagClass = 'text-bg-dark';
          else if (/full/i.test(course)) tagClass = 'text-bg-info';
          return `<span class="badge rounded-pill ${tagClass}">${course}</span>`;
        });
        $(this).html(tags.join(' '));
    });

    // ìƒíƒœ ì²˜ë¦¬
    $('.status').each(function () {
        const statusText = $(this).text().trim();
        const statusClassMap = {
          'ë§ˆê°': 'text-bg-light',
          'ì ‘ìˆ˜ì¤‘': 'text-bg-warning',
          'ì˜ˆì •': 'text-bg-dark'
        };
        const badgeClass = statusClassMap[statusText] || 'text-bg-secondary';
        $(this).html(`<span class="badge ${badgeClass}">${statusText}</span>`);
    });

    // í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
    $('.filter-btn').on('click', function() {
        $('.filter-btn').removeClass('active');
        $(this).addClass('active');
        filterCards();
    });

    $('.course-filter-btn').on('click', function() {
        $('.course-filter-btn').removeClass('active');
        $(this).addClass('active');
        filterCards();
    });

    // ì§€ë‚œëŒ€íšŒ ë³´ê¸° ìŠ¤ìœ„ì¹˜ ì´ë²¤íŠ¸
    $('#showPastSwitch').on('change', function() {
        filterCards();
    });

    // ìµœì´ˆ ë¡œë”© ì‹œì—ë„ í•„í„° ì ìš©
    $(function() {
        filterCards();
    });

    function filterCards() {
        const regionFilter = $('.filter-btn.active').data('filter');
        const courseFilter = $('.course-filter-btn.active').data('course');
        const showPast = $('#showPastSwitch').is(':checked');
        const today = new Date();
        today.setHours(0,0,0,0);

        $('.marathon-card').each(function() {
            const region = $(this).data('region');
            const courseRaw = ($(this).data('course') || '').toLowerCase();
            let show = true;

            // ì§€ì—­ í•„í„°
            if (regionFilter !== 'all' && region !== regionFilter) show = false;

            // ì½”ìŠ¤ í•„í„°
            if (courseFilter !== 'all') {
                if (courseFilter === 'Full') {
                    show = show && /full/i.test(courseRaw);
                } else if (courseFilter === 'Half') {
                    show = show && /half/i.test(courseRaw);
                } else if (courseFilter === '10km') {
                    show = show && /(1[0-2]k|10k|10km|11k|11km|12k|12km)/i.test(courseRaw);
                } else if (courseFilter === '5km') {
                    show = show && /\b([1-5]k|[1-5]km)\b/i.test(courseRaw);
                }
            }

            // ì§€ë‚œëŒ€íšŒ í•„í„° (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€)
            if (!showPast) {
                const eventDateStr = $(this).data('eventdate');
                if (eventDateStr) {
                    const eventDate = new Date(eventDateStr);
                    if (eventDate < today) show = false;
                }
            }

            $(this).toggle(show);
        });
    }
  }
});
</script>

</body>
</html>